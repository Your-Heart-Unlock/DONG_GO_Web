# User Token System (Engagement-only, Non-Monetary)

## ëª©ì 
ì´ ì‹œìŠ¤í…œì˜ ëª©ì ì€ **ìˆ˜ìµí™”ê°€ ì•„ë‹ˆë¼ ì°¸ì—¬ ìœ ë„**ì´ë‹¤.

- ë¦¬ë·°/ë°©ë¬¸/ì¥ì†Œ ë“±ë¡ì„ ë” ë§ì´ í•˜ê²Œ ë§Œë“¤ê¸°
- ë‹¨ìˆœ ì†Œë¹„ìê°€ ì•„ë‹ˆë¼ â€œê¸°ë¡í•˜ëŠ” ì‚¬ìš©ìâ€ë¥¼ ëŠ˜ë¦¬ê¸°
- ì„œë¹„ìŠ¤ ì´ˆë°˜ì— ì½˜í…ì¸  í’ˆì§ˆì„ ìœ ì§€í•˜ê¸°

í† í°ì€ **í™”íê°€ ì•„ë‹Œ í™œë™ í¬ì¸íŠ¸**ì´ë©°,
í˜„ê¸ˆ ê²°ì œ, ì¶©ì „, êµ¬ë§¤ ê°œë…ì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

## ê¸°ë³¸ ì›ì¹™ (ì¤‘ìš”)
1. ëˆê³¼ ì ˆëŒ€ ì—°ê²°í•˜ì§€ ì•ŠëŠ”ë‹¤
2. ê¸°ë³¸ ì •ë³´ëŠ” ëˆ„êµ¬ë‚˜ ë³¸ë‹¤
3. ì ê¸ˆ ëŒ€ìƒì€ â€œìƒì„¸ ë¦¬ë·° ì½˜í…ì¸ â€ì— í•œì •í•œë‹¤
4. í† í°ì€ ì¶©ë¶„íˆ ì–»ê¸° ì‰½ê³ , ìƒê¸° ì–´ë µë‹¤
5. ì´ ì‹œìŠ¤í…œì€ **ì–¸ì œë“  ì œê±° ê°€ëŠ¥**í•´ì•¼ í•œë‹¤

---

## í† í° ê°œë… ì •ì˜

- ëª…ì¹­(ê°€ì¹­): Token / Key / Unlock
- ì‚¬ìš©ìë³„ ë³´ìœ ëŸ‰: `users/{uid}.tokens`
- ê¸°ë³¸ê°’: ê°€ì… ì‹œ ì¼ì •ëŸ‰ ì§€ê¸‰ (ì˜ˆ: 5~10)

í† í°ì€ ë‹¤ìŒ ìš©ë„ë¡œë§Œ ì‚¬ìš©í•œë‹¤:
- **íŠ¹ì • ì¥ì†Œì˜ â€œìƒì„¸ ë¦¬ë·° ì˜ì—­â€ í•´ê¸ˆ**

---

## ë¬´ì—‡ì„ ì ê·¸ëŠ”ê°€ / ì ê·¸ì§€ ì•ŠëŠ”ê°€

### í•­ìƒ ê³µê°œ (í† í° í•„ìš” ì—†ìŒ)
- place ê¸°ë³¸ ì •ë³´ (ì´ë¦„, ìœ„ì¹˜, ì¹´í…Œê³ ë¦¬)
- ì§€ë„ ë§ˆì»¤
- ìš”ì•½ í†µê³„ (ë¦¬ë·° ìˆ˜, í‰ê°€ ë¶„í¬, ëŒ€í‘œ íƒœê·¸)
- ë¦¬ë·° ì¡´ì¬ ì—¬ë¶€

### í† í°ìœ¼ë¡œ í•´ê¸ˆë˜ëŠ” ì˜ì—­
- ê°œë³„ ë¦¬ë·°ì˜ ìƒì„¸ ë³¸ë¬¸
- ë°©ë¬¸ ë§¥ë½ (ëˆ„êµ¬ë‘ ê°”ëŠ”ì§€, ì–¸ì œ, ì¬ë°©ë¬¸ ì˜ì‚¬)
- ë¦¬ë·°ì— ì²¨ë¶€ëœ ì‚¬ì§„

> ì¦‰, â€œì—¬ê¸° ì‚¬ëŒë“¤ì´ ì–´ë–»ê²Œ ëŠê¼ˆëŠ”ì§€ ìš”ì•½â€ì€ ë³´ì´ì§€ë§Œ  
> â€œì™œ ê·¸ë ‡ê²Œ ëŠê¼ˆëŠ”ì§€ì˜ ë””í…Œì¼â€ì€ í•´ê¸ˆ ëŒ€ìƒì´ë‹¤.

---

## í† í° íšë“ ê·œì¹™ (MVP)

| í–‰ë™ | íšë“ í† í° |
|----|----|
| ì¥ì†Œ ë“±ë¡ | +1 |
| ë¦¬ë·° ì‘ì„± | +1 |
| ë°©ë¬¸ ê¸°ë¡ ì‘ì„± | +1 |
| ì‚¬ì§„ í¬í•¨ ë¦¬ë·° | +1 (ì„ íƒ) |

- í•˜ë£¨ ì œí•œ ì—†ìŒ (ì´ˆê¸°ì—” ë„‰ë„‰í•˜ê²Œ)
- ìŠ¤íŒ¸ ë°©ì§€ëŠ” ë³„ë„ moderationìœ¼ë¡œ ì²˜ë¦¬

---

## í† í° ì‚¬ìš© ê·œì¹™

- í† í°ì€ **ì¥ì†Œ ë‹¨ìœ„ë¡œ 1íšŒ ì†Œëª¨**
- í•œ ë²ˆ í•´ê¸ˆí•œ ì¥ì†ŒëŠ”:
  - ë‹¤ì‹œ í† í° ì†Œëª¨ ì—†ìŒ
  - ì´í›„ ëª¨ë“  ë¦¬ë·° ì ‘ê·¼ ê°€ëŠ¥

ì˜ˆ:
- Aì‹ë‹¹ ìƒì„¸ ë¦¬ë·° ìµœì´ˆ ì—´ëŒ â†’ í† í° -1
- ì´í›„ Aì‹ë‹¹ì€ í•­ìƒ ì—´ë ¤ ìˆìŒ

---

## UX ì •ì±… (ì¤‘ìš”)

### ì ê¸ˆ ìƒíƒœ í‘œì‹œ
- â€œğŸ”’ ì´ ì¥ì†Œì˜ ìƒì„¸ ë¦¬ë·°ëŠ” í† í° 1ê°œë¡œ í•´ê¸ˆí•  ìˆ˜ ìˆì–´ìš”â€
- í˜„ì¬ ë³´ìœ  í† í° ìˆ˜ í•­ìƒ ëª…ì‹œ

### í•´ê¸ˆ í™•ì¸
- ì¦‰ì‹œ í•´ê¸ˆ (confirm 1íšŒ)
- í•´ê¸ˆ í›„ì—ëŠ” ì ê¸ˆ UI ì™„ì „ ì œê±°

### í† í° ë¶€ì¡± ì‹œ
- ì°¨ë‹¨ ë©”ì‹œì§€:
  > â€œë¦¬ë·°ë¥¼ í•˜ë‚˜ ë‚¨ê¸°ë©´ í† í°ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”â€

---

## Firestore ë°ì´í„° ëª¨ë¸ (ì´ˆì•ˆ)

### users
```json
{
  "tokens": 7
}
```
- tokens : ì‚¬ìš©ìê°€ ë³´ìœ í•œ í† í° ìˆ˜
- ì´ˆê¸°ê°’ì€ ê°€ì… ì‹œ ì§€ê¸‰
- pending/guest ì‚¬ìš©ìëŠ” í† í° ê°œë… ë¯¸ì ìš©

---

### unlocks (ê¶Œì¥)
```pgsql
unlocks/{uid}_{placeId}
```

```json
{
    "uid": "user123",
    "placeId": "place456",
    "unlockedAt": "timestamp"
}
```

- íŠ¹ì • ì‚¬ìš©ìê°€ íŠ¹ì • ì¥ì†Œì˜ ìƒì„¸ ë¦¬ë·°ë¥¼ í•´ê¸ˆí–ˆìŒì„ ë‚˜íƒ€ë‚´ëŠ” ì»¬ë ‰ì…˜
- ë¬¸ì„œ IDëŠ” {uid}_{placeId} í˜•ì‹ìœ¼ë¡œ ê³ ì •
- í•œ ë²ˆ í•´ê¸ˆëœ ì¥ì†ŒëŠ” ì˜êµ¬ í•´ê¸ˆ (ì¬ì°¨ í† í° ì†Œëª¨ ì—†ìŒ)
- í•´ê¸ˆ ì •ë³´ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤

| unlocks ì»¬ë ‰ì…˜ì„ ë‘ëŠ” ì´ìœ :
| - ë™ì¼ ì¥ì†Œ ì ‘ê·¼ ì‹œ í† í° ì¤‘ë³µ ì°¨ê° ë°©ì§€
| - í† í° ì°¨ê°/í•´ê¸ˆ ë¡œì§ ë‹¨ìˆœí™”
| - í† í° ì‹œìŠ¤í…œ ì œê±° ì‹œì—ë„ ë°ì´í„° ë¬´ê²°ì„± ìœ ì§€

### í† í° ì°¨ê° / í•´ê¸ˆ ë¡œì§

1) ì‚¬ìš©ìê°€ íŠ¹ì • ì¥ì†Œ(placeId)ì˜ ìƒì„¸ ë¦¬ë·° ì ‘ê·¼ì„ ì‹œë„í•œë‹¤.

2) ì„œë²„(API)ì—ì„œ unlocks/{uid}_{placeId} ë¬¸ì„œ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
   - ì¡´ì¬í•¨ â†’ ì´ë¯¸ í•´ê¸ˆëœ ì¥ì†Œì´ë¯€ë¡œ ì¦‰ì‹œ ì ‘ê·¼ í—ˆìš©
   - ì¡´ì¬í•˜ì§€ ì•ŠìŒ â†’ í† í° í•„ìš”

3) users/{uid}.tokens ê°’ í™•ì¸
   - tokens >= 1 ì¸ ê²½ìš°:
     a) users/{uid}.tokens = tokens - 1
     b) unlocks/{uid}_{placeId} ë¬¸ì„œ ìƒì„±
        - uid
        - placeId
        - unlockedAt = serverTimestamp
     c) ì ‘ê·¼ í—ˆìš©
   - tokens < 1 ì¸ ê²½ìš°:
     - ì ‘ê·¼ ì°¨ë‹¨
     - "í† í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" ì•ˆë‚´ í‘œì‹œ

4) ì´í›„ ë™ì¼ placeIdì— ëŒ€í•´ì„œëŠ”
   unlocks ë¬¸ì„œ ì¡´ì¬ë¡œ ì¸í•´ í† í° ì†Œëª¨ ì—†ì´ í•­ìƒ ì ‘ê·¼ ê°€ëŠ¥

#### ì¤‘ìš” ì›ì¹™
- í† í° ì°¨ê°ê³¼ unlocks ìƒì„±ì€ ë°˜ë“œì‹œ ì„œë²„ ë¡œì§(API) ì—ì„œë§Œ ìˆ˜í–‰í•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ëŠ” â€œí•´ê¸ˆ ìš”ì²­â€ë§Œ ë³´ë‚¼ ìˆ˜ ìˆê³ , ìƒíƒœ ë³€ê²½ ê¶Œí•œì€ ì—†ë‹¤.

---

### ë³´ì•ˆ ë° ê¶Œí•œ ì›ì¹™
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ users.tokens ì§ì ‘ ìˆ˜ì • ê¸ˆì§€
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ unlocks ì§ì ‘ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê¸ˆì§€
- unlocks read:
  - request.auth.uid == unlocks.uid ì¸ ê²½ìš°ë§Œ í—ˆìš©
- pending / guest ì‚¬ìš©ìëŠ” í† í° ì‹œìŠ¤í…œ ëŒ€ìƒ ì•„ë‹˜

---

### Firestore Rules ì¶”ê°€ ì´ˆì•ˆ (í† í° ê´€ë ¨)

```js
match /unlocks/{unlockId} {
  // ë³¸ì¸ í•´ê¸ˆ ì •ë³´ë§Œ ì¡°íšŒ ê°€ëŠ¥
  allow read: if request.auth != null
    && resource.data.uid == request.auth.uid;

  // unlocksëŠ” ì„œë²„(API) ì „ìš©
  allow create, update, delete: if false;
}
```

| êµ¬í˜„ ë©”ëª¨
| - ì„œë²„(API)ëŠ” Firebase Admin SDKë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ Rulesë¥¼ ìš°íšŒí•´ write ê°€ëŠ¥
| - í´ë¼ì´ì–¸íŠ¸ SDKì—ì„œëŠ” unlocks writeê°€ ì „ë¶€ ì°¨ë‹¨ë¨

---

### MVP ë²”ìœ„ ì œí•œ (ëª…ì‹œ)
MVPì—ì„œ êµ¬í˜„í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥:
- í† í° êµ¬ë§¤ / ì¶©ì „
- í† í° ì„ ë¬¼ / êµí™˜
- ê¸°ê°„ ì œí•œ í† í°
- í•´ê¸ˆ ì·¨ì†Œ / í™˜ë¶ˆ
- ë ˆë²¨ / ë­í‚¹ ì‹œìŠ¤í…œ

---

### ë¹„í™œì„±í™”(ì œê±°) ì „ëµ
í† í° ì‹œìŠ¤í…œì„ ì œê±°í•˜ê³  ì‹¶ì„ ê²½ìš°:
1) unlocks ì²´í¬ ë¡œì§ ì œê±°
2) ëª¨ë“  ë¦¬ë·° ì ‘ê·¼ì„ ê¸°ë³¸ í—ˆìš©
3) users.tokens í•„ë“œ ë¯¸ì‚¬ìš©

ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì—†ì´ ì¦‰ì‹œ ë¹„í™œì„±í™” ê°€ëŠ¥í•´ì•¼ í•œë‹¤.

